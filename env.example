# =============================================================================
# WhisperX Diarization Server Environment Configuration  
# =============================================================================
# Copy to .env and customize for your environment
# All values shown are the actual defaults from the code - uncomment to override

# =============================================================================
# REQUIRED AUTHENTICATION
# =============================================================================
# HuggingFace token for accessing speaker diarization models
HUGGINGFACE_TOKEN=your_token_here

# =============================================================================
# CLOUDFLARE R2 CONFIGURATION
# =============================================================================
# Optional - enables R2 storage functionality
# Get these from your Cloudflare dashboard
# R2_ENDPOINT=https://your_account_id.r2.cloudflarestorage.com
# R2_ACCESS_KEY_ID=your_r2_access_key
# R2_SECRET_ACCESS_KEY=your_r2_secret_key

# =============================================================================
# DEFAULT STORAGE BUCKETS
# =============================================================================
# Configure default buckets for uploads and results
# DEFAULT_UPLOAD_BUCKET=default-uploads
# DEFAULT_RESULTS_BUCKET=default-results

# =============================================================================
# AWS S3 CONFIGURATION
# =============================================================================
# Optional - ONLY needed for S3 result export functionality
# Pre-signed S3 URLs work WITHOUT these credentials (they're already signed)
# Uses default AWS credential chain (environment, profile, IAM role)
# AWS_ACCESS_KEY_ID=your_aws_access_key
# AWS_SECRET_ACCESS_KEY=your_aws_secret_key
# AWS_DEFAULT_REGION=us-east-1

# =============================================================================
# CORE DIARIZATION PARAMETERS
# =============================================================================
# Speaker clustering threshold (0.5-1.0)
# Lower = more speakers detected | Higher = fewer speakers detected
# PYANNOTE_CLUSTERING_THRESHOLD=0.7

# Voice activity detection threshold (0.1-0.9)
# Controls sensitivity for detecting speech vs silence
# PYANNOTE_SEGMENTATION_THRESHOLD=0.45

# Minimum speaking time per speaker (seconds)
# Filters out very brief speaker assignments
# MIN_SPEAKER_DURATION=3.0

# Minimum confidence for speaker assignment (0.1-1.0)
# Higher = only high-confidence speaker labels
# SPEAKER_CONFIDENCE_THRESHOLD=0.6

# =============================================================================
# ADVANCED OPTIMIZATION SETTINGS
# =============================================================================
# Enable speaker transition smoothing (reduces rapid speaker switches)
# SPEAKER_SMOOTHING_ENABLED=true

# Minimum time between speaker switches (seconds)
# Prevents unrealistic rapid speaker changes
# MIN_SWITCH_DURATION=2.0

# Enable Voice Activity Detection validation (experimental, can be too aggressive)
# VAD_VALIDATION_ENABLED=false

# =============================================================================
# WHISPERX PERFORMANCE SETTINGS
# =============================================================================
# Batch size for processing (higher = faster but more memory)
# WHISPERX_BATCH_SIZE=16

# Use WAV2VEC2 alignment (true) or Whisper built-in alignment (false)
# true = best accuracy but slower | false = faster but less accurate
# USE_OPTIMIZED_ALIGNMENT=true

# Alignment Model Selection (optional - defaults to WhisperX's default English model)
# Choose based on your accuracy vs performance needs:
# ALIGN_MODEL=WAV2VEC2_ASR_BASE_960H           # Smaller, faster (~360MB) - recommended for high-throughput
# ALIGN_MODEL=WAV2VEC2_ASR_LARGE_LV60K_960H    # Larger, more accurate (~1.2GB) - best accuracy

# =============================================================================
# CONCURRENCY & TIMEOUT CONFIGURATION
# =============================================================================
# Maximum concurrent GPU transcription requests
# Adjust based on GPU memory (lower for limited memory, higher for powerful GPUs)
# MAX_CONCURRENT_REQUESTS=4

# Upload timeout for S3 presigned URL uploads (seconds)
# UPLOAD_TIMEOUT_SECONDS=3600

# Maximum time a job can run before being abandoned (seconds)
# Set to 0 to disable timeout (not recommended)
# JOB_PROCESSING_TIMEOUT_SECONDS=86400

# How long to keep job results available for retrieval (seconds)
# Results are stored locally and automatically cleaned up after this period
# Set to 0 to disable server-side result storage
# JOB_RESULT_RETENTION_SECONDS=86400

# Local directory for storing job results (must be writable)
# JOB_RESULTS_DIR=/tmp/whisper-job-results

# =============================================================================
# SERVER CONFIGURATION
# =============================================================================
# Server port (used by start_server.sh script)
# Note: Hard-coded to 3333 in python_server.py if run directly
# PORT=3333

# =============================================================================
# GPU OPTIMIZATION
# =============================================================================
# System-level GPU configuration (affects PyTorch behavior)
# CUDA_VISIBLE_DEVICES=0
# PYTORCH_CUDA_ALLOC_CONF=max_split_size_mb:512

# =============================================================================
# PARAMETER TUNING GUIDELINES
# =============================================================================
# 
# PROBLEM: Too many speakers detected (over-detection)
# SOLUTION:
#   PYANNOTE_CLUSTERING_THRESHOLD=0.8
#   SPEAKER_CONFIDENCE_THRESHOLD=0.8
#   MIN_SPEAKER_DURATION=5.0
#
# PROBLEM: Too few speakers detected (under-detection)
# SOLUTION:
#   PYANNOTE_CLUSTERING_THRESHOLD=0.5
#   SPEAKER_CONFIDENCE_THRESHOLD=0.4
#   VAD_VALIDATION_ENABLED=true
#
# PERFORMANCE OPTIMIZATION:
#   WHISPERX_BATCH_SIZE=4        # Lower memory usage
#   WHISPERX_BATCH_SIZE=32       # Higher performance (requires more GPU memory)
#   USE_OPTIMIZED_ALIGNMENT=false   # Faster (Whisper built-in alignment)
#   USE_OPTIMIZED_ALIGNMENT=true    # Best accuracy (WAV2VEC2 alignment)
#   ALIGN_MODEL=WAV2VEC2_ASR_BASE_960H  # Smaller alignment model for speed
